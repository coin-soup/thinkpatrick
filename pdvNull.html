<!-- Project Detail View with Video Timestamps -->
<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Project Detail: 2.5D Shooter</title>
    <script src="js/tailwind.min.js"></script>

    <link href="fonts/space-grotesk.css" rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#39FF14",
                        "background-dark": "#000000",
                        "surface": "#0A0A0A",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        html, body {
            overflow-x: hidden;
            width: 100%;
            position: relative;
            touch-action: pan-y;
            user-select: none;
            -webkit-user-select: none;
        }
        @layer base {
            body {
                @apply bg-background-dark text-slate-200 selection:bg-primary/30 selection:text-primary;
            }
        }
        .glow-neon:hover {
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.4);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #000000;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #39FF14;
        }
        @media (hover: hover) {
            #video-container.is-playing:hover #video-controls {
                opacity: 1;
            }
            #video-container.is-playing #video-controls {
                opacity: 0;
            }
        }
        #video-container.dragging #video-controls {
            opacity: 1 !important;
        }
        #video-container.dragging #progress-handle {
            scale: 1 !important;
        }
        /* YouTube-style Play Button Animation */
        @keyframes play-ping {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        .play-animate {
            animation: play-ping 0.4s ease-out forwards;
        }
        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background-color: #0A0A0A;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.8s;
        }
        #loading-screen.fade-out {
            opacity: 0;
            visibility: hidden;
        }
        .loader-content {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        .loader-radar {
            width: 120px;
            height: 120px;
            border: 1px solid rgba(57, 255, 20, 0.2);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }
        .loader-radar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0deg, rgba(57, 255, 20, 0.4) 0%, transparent 25%);
            transform-origin: 0 0;
            animation: radar-sweep 2s linear infinite;
        }
        .loader-radar-grid {
            position: absolute;
            inset: 0;
            background-image: 
                radial-gradient(rgba(57, 255, 20, 0.1) 1px, transparent 1px),
                linear-gradient(rgba(57, 255, 20, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(57, 255, 20, 0.05) 1px, transparent 1px);
            background-size: 20px 20px, 20px 20px, 20px 20px;
            background-position: center;
            border-radius: 50%;
        }
        @keyframes radar-sweep {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .loader-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 0.5em;
            text-transform: uppercase;
            color: #39FF14;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .loader-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
            display: inline-block;
            width: 1.5em;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>

<body class="bg-background-dark text-slate-300 min-h-screen">
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader-content">
            <div class="loader-radar">
                <div class="loader-radar-grid"></div>
            </div>
            <div class="loader-text">
                <span>System Initializing</span><span class="loader-dots"></span>
            </div>
        </div>
    </div>
    <header
        class="fixed top-0 left-0 right-0 z-[100] w-full border-b border-white/5 bg-black/95 backdrop-blur-md px-6 lg:px-20 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-primary/10 rounded">
                    <svg class="w-5 h-5 text-primary" viewBox="0 -960 960 960" fill="currentColor">
                        <path
                            d="M120-120v-520l360-200 360 200v520H120Zm80-80h560v-397L480-778 200-597v397Zm60-100h440v-80H260v80Zm0-140h440v-80H260v80Zm220-338 180 100v40H300v-40l180-100Z" />
                    </svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-white uppercase italic">Patrick<span
                        class="text-primary">.C</span></h1>
            </div>
            <nav class="flex items-center">
                <a href="index.html#work"
                    class="bg-primary text-black px-3 md:px-5 py-2 rounded-sm font-black text-[10px] md:text-xs uppercase tracking-widest glow-neon transition-all flex items-center gap-2">
                    <svg class="w-[16px] h-[16px] md:w-[18px] md:h-[18px]" viewBox="0 -960 960 960" fill="currentColor">
                        <path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z" />
                    </svg>
                    Back to Gallery
                </a>
            </nav>
        </div>
    </header>
    <main class="max-w-7xl mx-auto px-6 lg:px-20 pt-28 pb-10">
        <section class="mb-12">
            <div id="video-container"
                class="relative group rounded-none overflow-hidden bg-black aspect-video shadow-2xl ring-1 ring-white/10 cursor-pointer">
                <video id="project-video" class="w-full h-full object-cover" poster="img/tn-rpg3d.png" playsinline loop
                    preload="metadata">
                    <source src="vid/pvNull.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div id="loading-overlay" class="absolute inset-0 z-20 flex items-center justify-center bg-black/80">
                    <div class="flex flex-col items-center gap-3">
                        <svg class="animate-spin h-8 w-8 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <p class="text-[10px] font-black uppercase tracking-[0.3em] text-white/70">Loading</p>
                    </div>
                </div>
                <!-- Central Play Button (YouTube Style) -->
                <button id="center-play-btn"
                    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 text-white opacity-90 hover:opacity-100 transition-opacity drop-shadow-lg scale-100 active:scale-90 duration-200">
                    <span id="center-play-icon" class="flex items-center justify-center w-12 h-12 md:w-16 md:h-16">
                        <svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor">
                            <path d="M320-200v-560l440 280-440 280Z" />
                        </svg>
                    </span>
                </button>
                <div id="video-controls"
                    class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex flex-col pt-12">
                    <div class="px-3 pb-2 flex flex-col gap-1 pointer-events-auto">
                        <!-- Progress Bar (YouTube Style) -->
                        <div class="relative w-full h-12 mb-[-16px] flex items-center cursor-pointer group/progress"
                            id="progress-bar-container">
                            <div class="absolute inset-x-0 h-[3px] bg-white/20 rounded-full overflow-hidden">
                                <div id="progress-bar" class="h-full w-0 bg-primary shadow-[0_0_10px_#39FF14]"></div>
                            </div>
                            <div id="progress-handle"
                                class="absolute left-0 top-1/2 -translate-y-1/2 size-4 bg-primary rounded-full scale-0 group-hover/progress:scale-100 transition-transform duration-200">
                            </div>
                        </div>

                        <!-- Control Row -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-1 sm:gap-4">
                                <button id="play-pause-btn"
                                    class="size-8 sm:size-10 flex items-center justify-center text-white hover:text-primary transition-colors">
                                    <span class="fill-1 text-2xl sm:text-3xl flex items-center justify-center"
                                        id="play-icon">
                                        <svg class="w-6 h-6 sm:w-8 sm:h-8" viewBox="0 -960 960 960" fill="currentColor">
                                            <path d="M320-200v-560l440 280-440 280Z" />
                                        </svg>
                                    </span>
                                </button>

                                <div class="flex items-center gap-2 group/volume">
                                    <button id="volume-btn"
                                        class="size-8 sm:size-10 flex items-center justify-center text-white hover:text-primary transition-colors">
                                        <span class="text-xl sm:text-2xl flex items-center justify-center"
                                            id="volume-icon">
                                            <svg class="w-5 h-5 sm:w-6 sm:h-6" viewBox="0 -960 960 960"
                                                fill="currentColor">
                                                <path
                                                    d="M560-131v-82q90-26 145-100t55-167q0-93-55-167T560-747v-82q124 31 202 125.5T840-480q0 127-78 221.5T560-131ZM120-360v-240h160l200-200v640L280-360H120Zm440 40v-320q47 22 73.5 66t26.5 94q0 50-26.5 94T560-320Z" />
                                            </svg>
                                        </span>
                                    </button>
                                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5"
                                        class="w-0 opacity-0 pointer-events-none group-hover/volume:w-16 sm:group-hover/volume:w-24 group-hover/volume:opacity-100 group-hover/volume:pointer-events-auto h-1 bg-white/20 appearance-none cursor-pointer accent-primary transition-all duration-300">
                                </div>

                                <div class="text-[10px] sm:text-xs font-medium text-white/90 font-mono tracking-tight">
                                    <span id="current-time" class="font-mono text-xs md:text-sm">00:00:00</span>
                                    <span class="text-white/30">/</span>
                                    <span id="duration" class="font-mono text-xs md:text-sm">00:03:58</span>
                                </div>
                            </div>

                            <button id="fullscreen-btn"
                                class="size-8 sm:size-10 flex items-center justify-center text-white hover:text-primary transition-colors">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6" viewBox="0 -960 960 960" fill="currentColor">
                                    <path
                                        d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
            <div class="lg:col-span-8 flex flex-col gap-12">
                <div>
                    <h2 class="text-5xl font-bold mb-8 tracking-tighter text-white uppercase italic">2.5D Shooter
                        <span class="text-primary">v.Null</span>
                    </h2>
                    <p class="text-lg leading-relaxed text-slate-400 mb-10 font-light max-w-3xl">
                        Aimed not only for learning purposes, but also to win the CSE open house nominations. This is
                        the first time I led a team of designers, artists, musicians, and programmers. Most importantly,
                        I thoroughly enjoyed the process and felt extremely rewarded when my team and I won the academic
                        nominations.
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span
                            class="px-4 py-1.5 bg-white/5 border border-white/10 text-[10px] font-black text-primary uppercase tracking-[0.2em]">Unity</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8 py-10 border-y border-white/10">
                    <div>
                        <p class="text-[9px] uppercase tracking-[0.3em] text-slate-500 mb-2 font-bold">Category</p>
                        <p class="font-bold text-white text-sm">2.5D Game Development</p>
                    </div>
                    <div>
                        <p class="text-[9px] uppercase tracking-[0.3em] text-slate-500 mb-2 font-bold">Engine</p>
                        <p class="font-bold text-white text-sm">Unity (C#)</p>
                    </div>
                    <div>
                        <p class="text-[9px] uppercase tracking-[0.3em] text-slate-500 mb-2 font-bold">Origin</p>
                        <p class="font-bold text-white text-sm">College Project</p>
                    </div>
                    <div>
                        <p class="text-[9px] uppercase tracking-[0.3em] text-slate-500 mb-2 font-bold">Release</p>
                        <p class="font-bold text-white text-sm">2015</p>
                    </div>
                </div>
                <div class="bg-surface p-10 border border-white/10 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-primary/5 blur-3xl rounded-full"></div>
                    <h3 class="text-xl font-bold mb-6 text-white uppercase tracking-tight">Description</h3>
                    <ul class="space-y-6">
                        <li class="flex gap-5">
                            <div>
                                <p class="text-sm font-bold text-white mb-1 uppercase tracking-wide">Top
                                    Responsibilities</p>
                                <p class="text-sm text-slate-400">1. Gameplay Programming</p>
                                <p class="text-sm text-slate-400">2. Tools Developments</p>
                                <p class="text-sm text-slate-400">3. Recruited & led a team of 9 students that are in
                                    different
                                    fields of specialty</p>
                            </div>
                        </li>
                        <li class="flex gap-5">
                            <div>
                                <p class="text-sm font-bold text-white mb-1 uppercase tracking-wide">Role</p>
                                <p class="text-sm text-slate-400">Unity Developer & Team Lead</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="lg:col-span-4">
                <div class="lg:sticky lg:top-28 bg-surface border border-white/10">
                    <div class="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
                        <h3 class="font-bold text-sm uppercase tracking-[0.2em] text-white">Keyframes</h3>
                        <span class="text-[10px] font-black bg-primary text-black px-2 py-0.5"
                            id="keyframe-sync-badge">08 POINTS SYNC</span>
                    </div>
                    <div id="keyframe-container" class="divide-y divide-white/5">
                        <!-- Keyframes will be injected here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <section class="mt-24 pt-24 border-t border-white/10 flex flex-col items-center text-center">
            <h2 class="text-4xl font-bold mb-8 tracking-tighter text-white uppercase italic">Ready to deploy?</h2>
            <div class="flex flex-col sm:flex-row gap-6">
                <a href="index.html#contact" target="_self"
                    class="bg-primary text-black px-12 py-5 font-black uppercase tracking-widest text-sm glow-neon transition-all flex items-center justify-center gap-3">
                    Start a Conversation
                    <svg class="w-5 h-5" viewBox="0 -960 960 960" fill="currentColor">
                        <path d="m303-80 57-300H200l240-500h120l-57 300h160L423-80h-120Z" />
                    </svg>
                </a>
            </div>

            <footer
                class="mt-32 w-full flex flex-col md:flex-row justify-between items-center gap-8 text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] md:tracking-[0.3em]">
                <div class="flex items-center gap-4 text-white/40">
                    <p>Â© All Rights Reserved</p>
                </div>
                <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8 font-bold text-white/40">
                    <a class="hover:text-primary transition-colors">WeChat ID: SilkRoadA2Z</a>
                    <a class="hover:text-primary transition-colors">Email: careerDLL@outlook.com</a>
                    <a class="hover:text-primary transition-colors"
                        href="https://linkedin.com/in/PatrickEXE">LinkedIn</a>
                </div>
            </footer>
        </section>
    </main>

    <script>
        const BILI_IFRAME_LINK = `<iframe src="//player.bilibili.com/player.html?isOutside=true&aid=115916268445257&bvid=BV1iAktBVEZh&cid=35467625354" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>`;

        const PROJECT_DEFAULTS = {
            startTime: 12,
            startsMuted: false
        };

        const PROJECT_KEYFRAMES = [
            { time: 19, label: '00:19', title: 'Teaser', hot: true },
            { time: 51, label: '00:51', title: 'City Overview', hot: true },
            { time: 81, label: '01:21', title: 'Sword' },
            { time: 102, label: '01:42', title: 'Pistol' },
            { time: 122, label: '02:02', title: 'Machine Gun' },
            { time: 130, label: '02:10', title: 'Overpowered Weapon: Guitar' },
            { time: 147, label: '02:27', title: 'Overpowered Weapon: Bazooka' },
            { time: 193, label: '03:13', title: 'Final Boss: Dr.Irtech', hot: true }
        ];

        function parseBiliLink(link) {
            const srcMatch = link.match(/src="([^"]+)"/);
            const src = srcMatch ? srcMatch[1] : '';
            const search = src.includes('?') ? src.split('?')[1] : '';
            const params = new URLSearchParams(search);
            return {
                bvid: params.get('bvid') || '',
                aid: params.get('aid') || '',
                cid: params.get('cid') || '',
                t: params.get('t')
            };
        }

        const BILI_IDS = parseBiliLink(BILI_IFRAME_LINK);
        const START_TIME = (PROJECT_DEFAULTS.startTime !== undefined) ? PROJECT_DEFAULTS.startTime : (BILI_IDS.t ? parseInt(BILI_IDS.t) : 0);

        const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const chinaTimeZones = ['Asia/Shanghai', 'Asia/Chongqing', 'Asia/Harbin', 'Asia/Urumqi', 'Asia/Kashgar', 'Asia/Hong_Kong', 'Asia/Macau', 'Asia/Taipei', 'PRC'];
        const isGMT8 = (new Date().getTimezoneOffset() === -480);
        const urlParams = new URLSearchParams(window.location.search);
        const isChinaUser = urlParams.get('forceBili') === 'true' || (!(urlParams.get('forceLocal') === 'true') && (chinaTimeZones.includes(userTimeZone) || isGMT8));

        const loadingOverlay = document.getElementById('loading-overlay');
        const hideLoading = () => { if (loadingOverlay) loadingOverlay.style.display = 'none'; };

        const keyframeContainer = document.getElementById('keyframe-container');
        const keyframeSyncBadge = document.getElementById('keyframe-sync-badge');
        if (keyframeContainer) {
            if (keyframeSyncBadge) keyframeSyncBadge.textContent = `${String(PROJECT_KEYFRAMES.length).padStart(2, '0')} POINTS SYNC`;
            keyframeContainer.innerHTML = PROJECT_KEYFRAMES.map(kf => `
                <button data-time="${kf.time}" class="w-full flex items-center gap-5 p-5 hover:bg-white/[0.03] transition-colors group text-left analysis-node">
                    <div class="flex-1">
                        <p class="text-[10px] font-black text-white/40 mb-1 uppercase tracking-widest">${kf.label}</p>
                        <p class="text-sm font-bold text-white group-hover:text-primary transition-colors uppercase">
                            ${kf.title}${kf.hot ? ' <span class="text-red-500">hot~</span>' : ''}
                        </p>
                    </div>
                </button>
            `).join('');
        }

        const triggerBiliPlay = (time = null) => {
            const iframe = document.getElementById('bili-player');
            if (!iframe) return;
            const stayMuted = PROJECT_DEFAULTS.startsMuted;
            if (time !== null) {
                iframe.src = buildBiliUrl(time, 1, stayMuted ? 1 : 0) + '&_t=' + Date.now();
                window.isBiliPlaying = true;
                window.isBiliInitialized = true;
            } else if (!window.isBiliInitialized) {
                postToBili({ type: 'play' });
                window.isBiliPlaying = true;
                window.isBiliInitialized = true;
            } else {
                window.isBiliPlaying = !window.isBiliPlaying;
                postToBili({ type: window.isBiliPlaying ? 'play' : 'pause' });
            }

            if (window.isBiliPlaying) {
                setTimeout(() => {
                    postToBili({ type: 'play', muted: stayMuted, volume: stayMuted ? 0 : 1 });
                    postToBili({ type: 'changeVolume', value: stayMuted ? 0 : 1 });
                    postToBili({ type: 'changeQuality', value: 64 });
                    postToBili({ type: 'changeDanmaku', value: false });
                }, 500);
            }
        };

        const postToBili = (msg) => {
            const iframe = document.getElementById('bili-player');
            if (!iframe?.contentWindow) return;
            try {
                iframe.contentWindow.postMessage(msg, '*');
                if (msg.type) iframe.contentWindow.postMessage(JSON.stringify(msg), '*');
            } catch (e) { }
        };

        const buildBiliUrl = (time = START_TIME, autoplay = 0, muted = PROJECT_DEFAULTS.startsMuted ? 1 : 0) => {
            const params = new URLSearchParams({
                bvid: BILI_IDS.bvid, aid: BILI_IDS.aid, cid: BILI_IDS.cid,
                t: String(time), danmaku: '0', high_quality: '1',
                autoplay: String(autoplay), muted: String(muted),
                as_wide: '1', p: '1', isOutside: 'true'
            });
            return `https://player.bilibili.com/player.html?${params.toString()}`;
        };

        let isBiliActive = false;
        const switchToBili = () => {
            if (isBiliActive || !BILI_IDS.bvid) return;
            isBiliActive = true;
            console.log("Local video failed or timed out. Switching to Bilibili...");

            const videoContainer = document.getElementById('video-container');
            const localVideo = document.getElementById('project-video');
            const videoControls = document.getElementById('video-controls');
            const centerPlayBtn = document.getElementById('center-play-btn');

            if (localVideo) localVideo.remove();
            if (videoControls) videoControls.remove();
            if (centerPlayBtn) centerPlayBtn.remove();

            const iframe = document.createElement('iframe');
            iframe.id = 'bili-player';
            iframe.src = buildBiliUrl(START_TIME, 0, 0);
            iframe.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:100%;border:0;';
            iframe.allow = 'fullscreen; picture-in-picture; encrypted-media; gyroscope';
            iframe.allowFullscreen = true;
            iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');
            iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-presentation');
            videoContainer.prepend(iframe);

            window.isBiliPlaying = false;
            window.isBiliInitialized = false;

            iframe.onload = () => { setTimeout(hideLoading, 1000); };

            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (!isMobile) {
                const mask = document.createElement('div');
                mask.id = 'bili-mask';
                mask.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:calc(100% - 120px);z-index:5;cursor:pointer;';
                mask.addEventListener('click', () => triggerBiliPlay());
                videoContainer.appendChild(mask);
            }
        };

        // Bilibili-First Logic for China Users
        if (isChinaUser && BILI_IDS.bvid) {
            switchToBili();
        }

        // Initialize Local Video Controls
        const initLocalControls = () => {
            const video = document.getElementById('project-video');
            if (!video) return;
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const currentTimeEl = document.getElementById('current-time');
            const durationEl = document.getElementById('duration');
            const progressBar = document.getElementById('progress-bar');
            const progressHandle = document.getElementById('progress-handle');
            const progressBarContainer = document.getElementById('progress-bar-container');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const centerPlayBtn = document.getElementById('center-play-btn');
            const centerPlayIcon = document.getElementById('center-play-icon');
            const videoContainer = document.getElementById('video-container');
            const volumeBtn = document.getElementById('volume-btn');
            const volumeIcon = document.getElementById('volume-icon');
            const volumeSlider = document.getElementById('volume-slider');

            const formatTime = (s) => {
                if (!s || isNaN(s) || !isFinite(s)) return "00:00:00";
                const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = Math.floor(s % 60);
                return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            };

            const updateProgress = () => {
                if (!video.duration) return;
                const percent = (video.currentTime / video.duration) * 100;
                progressBar.style.width = `${percent}%`;
                progressHandle.style.left = `${percent}%`;
                currentTimeEl.textContent = formatTime(video.currentTime);
            };

            const togglePlay = () => {
                if (video.paused) video.play().catch(() => { video.muted = true; video.play(); });
                else video.pause();
            };

            const ICONS = {
                play: '<svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor"><path d="M320-200v-560l440 280-440 280Z"/></svg>',
                pause: '<svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor"><path d="M560-200v-560h160v560H560Zm-320 0v-560h160v560H240Z"/></svg>',
                volume_up: '<svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor"><path d="M120-360v-240h160l200-200v640L280-360H120Zm440 40v-320q47 22 73.5 66t26.5 94q0 50-26.5 94T560-320ZM560-131v-82q90-26 145-100t55-167q0-93-55-167T560-747v-82q124 31 202 125.5T840-480q0 127-78 221.5T560-131Z"/></svg>',
                volume_down: '<svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor"><path d="M120-360v-240h160l200-200v640L280-360H120Zm440 40v-320q47 22 73.5 66t26.5 94q0 50-26.5 94T560-320Z"/></svg>',
                volume_off: '<svg class="w-full h-full" viewBox="0 -960 960 960" fill="currentColor"><path d="M120-360v-240h160l200-200v640L280-360H120Zm608-52-114-114-114 114-56-56 114-114-114-114 56-56 114 114 114-114 56 56-114 114 114 114-56 56Z"/></svg>'
            };

            if (playPauseBtn) playPauseBtn.addEventListener('click', togglePlay);
            if (centerPlayBtn) centerPlayBtn.addEventListener('click', () => { centerPlayBtn.classList.add('play-animate'); togglePlay(); });
            video.addEventListener('play', () => { if (playIcon) playIcon.innerHTML = ICONS.pause; if (centerPlayIcon) centerPlayIcon.innerHTML = ICONS.pause; centerPlayBtn.style.display = 'none'; videoContainer.classList.add('is-playing'); hideLoading(); });
            video.addEventListener('pause', () => { if (playIcon) playIcon.innerHTML = ICONS.play; if (centerPlayIcon) centerPlayIcon.innerHTML = ICONS.play; centerPlayBtn.style.display = 'block'; centerPlayBtn.classList.remove('play-animate'); videoContainer.classList.remove('is-playing'); });
            video.addEventListener('timeupdate', updateProgress);

            videoContainer.addEventListener('click', (e) => {
                if (!e.target.closest('button') && !e.target.closest('#progress-bar-container') && !e.target.closest('#volume-slider')) togglePlay();
            });

            let seeked = false;
            const skip = () => { if (!seeked && (video.readyState >= 1 || video.duration > 0)) { video.currentTime = START_TIME; seeked = true; } };
            ['loadedmetadata', 'canplay', 'play'].forEach(ev => video.addEventListener(ev, skip));
            const skipInt = setInterval(() => { if (seeked) clearInterval(skipInt); else skip(); }, 200);

            video.volume = 0.5; video.muted = PROJECT_DEFAULTS.startsMuted;
            const updateVolumeIcon = () => {
                if (video.muted || video.volume === 0) {
                    if (volumeIcon) volumeIcon.innerHTML = ICONS.volume_off;
                    if (volumeSlider) volumeSlider.value = 0;
                } else if (video.volume < 0.6) {
                    if (volumeIcon) volumeIcon.innerHTML = ICONS.volume_down;
                    if (volumeSlider) volumeSlider.value = video.volume;
                } else {
                    if (volumeIcon) volumeIcon.innerHTML = ICONS.volume_up;
                    if (volumeSlider) volumeSlider.value = video.volume;
                }
            };
            updateVolumeIcon();

            video.addEventListener('loadedmetadata', () => { durationEl.textContent = formatTime(video.duration); hideLoading(); });
            if (volumeBtn) volumeBtn.addEventListener('click', () => { video.muted = !video.muted; updateVolumeIcon(); });
            if (volumeSlider) volumeSlider.addEventListener('input', (e) => { video.volume = e.target.value; video.muted = video.volume === 0; updateVolumeIcon(); });

            let isDragging = false;
            const setPos = (e) => {
                const rect = progressBarContainer.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX);
                video.currentTime = Math.max(0, Math.min(1, (x - rect.left) / rect.width)) * video.duration;
            };
            if (progressBarContainer) {
                progressBarContainer.addEventListener('mousedown', (e) => { isDragging = true; videoContainer.classList.add('dragging'); setPos(e); });
                progressBarContainer.addEventListener('touchstart', (e) => { isDragging = true; videoContainer.classList.add('dragging'); setPos(e); }, { passive: false });
                window.addEventListener('mousemove', (e) => { if (isDragging) setPos(e); });
                window.addEventListener('touchmove', (e) => { if (isDragging) { e.preventDefault(); setPos(e); } }, { passive: false });
                window.addEventListener('mouseup', () => { if (isDragging) { isDragging = false; videoContainer.classList.remove('dragging'); } });
                window.addEventListener('touchend', () => { if (isDragging) { isDragging = false; videoContainer.classList.remove('dragging'); } });
            }
            if (fullscreenBtn) fullscreenBtn.addEventListener('click', () => { if (video.requestFullscreen) video.requestFullscreen(); else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen(); });
        };

        initLocalControls();

        // Global Analysis Node Click Handler
        document.addEventListener('click', (e) => {
            const node = e.target.closest('.analysis-node');
            if (node) {
                const time = parseFloat(node.dataset.time);
                if (isBiliActive && BILI_IDS.bvid) {
                    triggerBiliPlay(time);
                } else {
                    const video = document.getElementById('project-video');
                    if (video) {
                        video.currentTime = time; video.muted = false; if (video.volume === 0) video.volume = 0.5;
                        video.play();
                    }
                }
                document.getElementById('video-container').scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.querySelectorAll('.analysis-node').forEach(n => {
                    n.classList.remove('bg-primary/5', 'border-l-2', 'border-primary');
                    n.classList.add('hover:bg-white/[0.03]');
                    const p = n.querySelectorAll('p');
                    if (p.length >= 2) { p[0].classList.replace('text-primary', 'text-white/40'); p[1].classList.replace('text-primary', 'text-white'); }
                });
                node.classList.add('bg-primary/5', 'border-l-2', 'border-primary');
                node.classList.remove('hover:bg-white/[0.03]');
                const p = node.querySelectorAll('p');
                if (p.length >= 2) { p[0].classList.replace('text-white/40', 'text-primary'); p[1].classList.replace('text-white', 'text-primary'); }
            }
        });

        // Loading Screen Management
        window.addEventListener('load', () => {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                setTimeout(() => {
                    loadingScreen.classList.add('fade-out');
                    setTimeout(() => loadingScreen.remove(), 800);
                }, 1000);
            }
        });
    </script>
</body>

</html>